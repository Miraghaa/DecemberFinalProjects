@model ContactVM
@{
    Layout = null; 
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>December</title>
    <link rel="icon" href="//ap-lotita.myshopify.com/cdn/shop/files/icon-f.png?crop=center&height=32&v=1676542004&width=32">
    <link rel="stylesheet" href="~/assets/css/bootstrap.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css" />
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300&family=Outfit:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/assets/css/style.css">
</head>
<body>
<main id="Checkout">
    <!-- Start-Main -->
    <section id="Checkout-All">
            <form id="memberForm" method="post" style="display:flex;" asp-controller="Order" asp-action="Create">
                <div class="long-line-left">
                <h1><a style="color: black;" asp-controller="Home" asp-action="Index">December</a></h1>
                        @if (User.IsInRole("Member"))
                        {
                            <div class="row">
                                <div class="col-lg-6">
                                    <p>First Name<span>*</span></p>
                                    <input style="width: 90%;" type="text" value="@Model.AppUser.FirstName" placeholder="@Model.AppUser.FirstName" name="FirstName">
                                </div>
                                <div class="col-lg-6">
                                    <p>Last Name<span>*</span></p>
                                    <input style="width: 90%;margin-left: -45px;" value="@Model.AppUser.FirstName" type="text" placeholder="@Model.AppUser.LastName" name="LastName">
                                </div>
                            </div>

                            @if (Model.Adresses != null && Model.Adresses.Any())
                            {
                                foreach (var address in Model.Adresses)
                                {
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <p>Country<span>*</span></p>
                                            <input type="text" value="@address.Country" name="Country">
                                        </div>
                                        <div class="col-lg-12">
                                            <p>Country/State<span>*</span></p>
                                            <input type="text" value="@address.State" name="State">
                                        </div>
                                        <div class="col-lg-12">
                                            <p>Town/City<span>*</span></p>
                                            <input type="text" value="@address.City" name="City">
                                        </div>
                                        <div class="col-lg-12">
                                            <p>Adress<span>*</span></p>
                                            <input type="text" value="@address.Adresss" name="Address">
                                        </div>
                                        <div class="col-lg-12">
                                            <p>Postcode/Zip<span>*</span></p>
                                            <input type="text" value="@address.Postcode" name="Postcode">
                                        </div>
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="row">
                                    <div class="col-lg-12">
                                        <p>Country<span>*</span></p>
                                        <input type="text" value="" placeholder="Country" name="Country">
                                    </div>
                                    <div class="col-lg-12">
                                        <p>Country/State<span>*</span></p>
                                        <input type="text" value="" placeholder="State" name="State">
                                    </div>
                                    <div class="col-lg-12">
                                        <p>Town/City<span>*</span></p>
                                        <input type="text" value="" placeholder="City" name="City">
                                    </div>
                                    <div class="col-lg-12">
                                        <p>Adress<span>*</span></p>
                                        <input type="text" value="" placeholder="Adress" name="Address">
                                    </div>
                                    <div class="col-lg-12">
                                        <p>Postcode/Zip<span>*</span></p>
                                        <input type="text" value="" placeholder="Postcode" name="Postcode">
                                    </div>
                                </div>
                            }

                            <div class="row">
                                <div class="col-lg-6">
                                    <p>Email<span>*</span></p>
                                    <input style="width: 90%;" type="email" value="@Model.AppUser.Email" placeholder="@Model.AppUser.Email" name="Email">
                                </div>
                                <div class="col-lg-6">
                                    <p>Phone<span>*</span></p>
                                    <input style="width: 90%; " type="text" value="@Model.AppUser.PhoneNumber" placeholder="@Model.AppUser.PhoneNumber" name="PhoneNumber">
                                </div>
                            </div>
                        }
                    

                </div>
                <div class="order-by ">
                <div class="order-all row">
                </div>
                <div class="Total-price">
                    <div>
                        <p>Total</p>
                        <p> <span style="color: #bdbdbd; font-weight: 400;">USD</span> <span style="font-size: 25px;">$</span><span style="font-size: 25px;" id="Totals">0</span></p>
                    </div>
                </div>
                <div class="Orderr">
                    <a class="a1" asp-controller="Shop" asp-action="Index">Continue shopping</a>
                        <a id="buyProducts"  class="a2" h>Buy products</a>
                    </div>
            </div>
            </form>
        </section>
</main> <!-- End-MAin -->
    <!--Scripts kodlari-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="~/assets/js/app.js"></script>
    <script src="~/assets/js/basket.js"></script>
    <script src="~/assets/js/wishlist.js"></script>
    <script src="~/assets/js/CheckOut.js"></script>
    <!-- Diğer HTML içeriği -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="~/assets/js/app.js"></script>
    <script src="~/assets/js/basket.js"></script>
    <script src="~/assets/js/wishlist.js"></script>
    <script src="~/assets/js/CheckOut.js"></script>

    <script>
        var localStorageData = JSON.parse(localStorage.getItem('basket'));
        console.log(localStorageData);
        $(document).ready(function () {
            $("#buyProducts").click(function (e) {
                e.preventDefault();
                var formData = {
                    FirstName: $("#memberForm input[name='FirstName']").val(),
                    LastName: $("#memberForm input[name='LastName']").val(),
                    Country: $("#memberForm input[name='Country']").val(),
                    State: $("#memberForm input[name='State']").val(),
                    City: $("#memberForm input[name='City']").val(),
                    Address: $("#memberForm input[name='Address']").val(),
                    Postcode: $("#memberForm input[name='Postcode']").val(),
                    Email: $("#memberForm input[name='Email']").val(),
                    PhoneNumber: $("#memberForm input[name='PhoneNumber']").val(),
                    // Diğer form alanlarını ekleyin
                };
                var localStorageData = JSON.parse(localStorage.getItem('basket'));
                localStorageData.forEach(function (item) {
                    item.price = parseFloat(item.price.replace('$', '').trim());
                });

                var jsonData = localStorageData.map(function (item) {
                    return {
                        Name: item.yazi,
                        IamgeUrl: item.sekil,
                        Price: item.price,
                        Count: item.Count,
                        Id: item.id
                    };
                });

                if (localStorageData && localStorageData.length > 0) {
                    // İlk aksiyon: Sepet verilerini JSON olarak gönderme
                    $.ajax({
                        type: 'POST',
                        url: '/Order/Basket',
                        contentType: 'application/json',
                        data: JSON.stringify(jsonData),
                        success: function (response) {
                            console.log('Başarılı (Basket): ', response);

                            // İkinci aksiyon: Siparişi oluşturma
                            $.ajax({
                                type: 'POST',
                                url: '/Order/Create',
                                data: {
                                    FirstName: formData.FirstName,
                                    LastName: formData.LastName,
                                    Country: formData.Country,
                                    State: formData.State,
                                    City: formData.City,
                                    Address: formData.Address,
                                    Postcode: formData.Postcode,
                                    Email: formData.Email,
                                    PhoneNumber: formData.PhoneNumber
                                    // Diğer form alanlarını ekleyin
                                },
                                success: function (secondActionResult) {
                                    console.log('Başarılı (Create): ', secondActionResult);
                                    localStorage.clear();
                                    window.location.href = '/Shop/Index';
                                },
                                error: function (error) {
                                    console.log('Hata (Create): ', error);
                                    console.log('Hata Detayı (Create): ', error.responseText);
                                }
                            });
                        },
                        error: function (error) {
                            console.log('Hata (Basket): ', error);
                            console.log('Hata Detayı (Basket): ', error.responseText);
                        }
                    });
                } else {
                    // Sepet verileri boş veya geçersiz olduğunda kullanıcıyı uyar
                    alert('Sepetiniz boş veya geçersiz.');
                }

            });

        });
    </script>

</body>
</html>